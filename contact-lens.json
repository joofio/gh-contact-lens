{
  "resourceType": "Library",
  "id": "contact-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "contact-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Contact lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para Contacto"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para Contacto"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til Kontakt"
          }
        ]
      }
    ]
  },
  "title": "Contact Info Lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para contacto"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para contacto"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til kontakt"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2024-06-12T12:23:10.005Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that adds clickable contact links (email/phone) from the patient's healthcare provider information",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que añade enlaces de contacto clicables (email/teléfono) de la información del proveedor de salud del paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que adiciona links de contacto clicáveis (email/telefone) da informação do prestador de cuidados de saúde do paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der tilføjer klikbare kontaktlinks (email/telefon) fra patientens sundhedsudbyder information"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Add clickable contact links (mailto/tel) to contact sections in a preprocessed ePI using the patient's general practitioner information.",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Añadir enlaces de contacto clicables (mailto/tel) a las secciones de contacto en una ePI preprocesada usando la información del médico de cabecera del paciente."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Adicionar links de contacto clicáveis (mailto/tel) às secções de contacto numa ePI pré-processada usando a informação do médico de família do paciente."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Tilføj klikbare kontaktlinks (mailto/tel) til kontaktsektioner i en forbehandlet ePI ved brug af patientens praktiserende læge information."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for contact information",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwpsZXQgbGFuZyA9ICIiOyAgLy8gRGVmYXVsdCBsYW5ndWFnZSwgd2lsbCBiZSBzZXQgYnkgZVBJCgpsZXQgZ2V0U3BlY2lmaWNhdGlvbiA9ICgpID0+IHsKICAgIHJldHVybiAiMi4wLjMtY29udGFjdC1iYW5uZXIiOwp9OwovL2RvY3VtZW50LCBodG1sRGF0YSwgYmFubmVySFRNTAovLwpjb25zdCBpbnNlcnRDb250YWN0TGlua3MgPSAobGlzdE9mQ2F0ZWdvcmllcywgY29udGFjdHMsIGRvY3VtZW50LCByZXNwb25zZSkgPT4gewogICAgbGlzdE9mQ2F0ZWdvcmllcy5mb3JFYWNoKChjbGFzc05hbWUpID0+IHsKICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmluY2x1ZGVzKGBjbGFzcz0iJHtjbGFzc05hbWV9YCkgfHwKICAgICAgICAgICAgcmVzcG9uc2UuaW5jbHVkZXMoYGNsYXNzPScke2NsYXNzTmFtZX1gKQogICAgICAgICkgewogICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgZWwgPSBlbGVtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBjb250YWN0cy5mb3JFYWNoKGNvbnRhY3QgPT4gewogICAgICAgICAgICAgICAgICAgIGxldCBocmVmID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhY3QudHlwZSA9PT0gImVtYWlsIikgewogICAgICAgICAgICAgICAgICAgICAgICBocmVmID0gYG1haWx0bzoke2NvbnRhY3QudmFsdWV9YDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhY3QudHlwZSA9PT0gInBob25lIikgewogICAgICAgICAgICAgICAgICAgICAgICBocmVmID0gYHRlbDoke2NvbnRhY3QudmFsdWV9YDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChocmVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSA8YT4gYW5kIHdyYXAgZXhpc3RpbmcgY29udGVudAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICAgICAgICAgICAgICBhLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGhyZWYpOwogICAgICAgICAgICAgICAgICAgICAgICBhLnNldEF0dHJpYnV0ZSgidGFyZ2V0IiwgIl9ibGFuayIpOwogICAgICAgICAgICAgICAgICAgICAgICBhLmNsYXNzTGlzdC5hZGQoImNvbnRhY3QtbGVucyIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgYS5pbm5lckhUTUwgPSBlbC5pbm5lckhUTUw7ICAvLyBtb3ZlIG9yaWdpbmFsIGNvbnRlbnQgaW50byA8YT4KICAgICAgICAgICAgICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0gIiI7ICAgICAgICAgICAvLyBjbGVhciBvcmlnaW5hbCBjb250ZW50CiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGEpOyAgICAgICAgICAgLy8gaW5zZXJ0IHRoZSA8YT4gaW5zaWRlIHRoZSBvcmlnaW5hbCBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KQoKCiAgICAvLyBDbGVhbiBoZWFkIChzYW1lIGFzIHlvdXIgb3JpZ2luYWwgbG9naWMpCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5yZW1vdmUoKTsKICAgIH0KCiAgICAvLyBFeHRyYWN0IEhUTUwgcmVzdWx0CiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmlubmVySFRNTDsKICAgICAgICBjb25zb2xlLmxvZygiUmVzcG9uc2U6ICIgKyByZXNwb25zZSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCJSZXNwb25zZTogIiArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUwpOwogICAgICAgIHJlc3BvbnNlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTDsKICAgIH0KCiAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnRyaW0oKSA9PT0gIiIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFubm90YXRpb24gcHJvY2VzcyBmYWlsZWQ6IGVtcHR5IG9yIG51bGwgcmVzcG9uc2UiKTsKICAgIH0KCiAgICByZXR1cm4gcmVzcG9uc2U7Cn07CgpsZXQgZW5oYW5jZSA9IGFzeW5jICgpID0+IHsKICAgIGlmICghaXBzRGF0YSB8fCAhaXBzRGF0YS5lbnRyeSB8fCBpcHNEYXRhLmVudHJ5Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiSVBTIGlzIGVtcHR5IG9yIGludmFsaWQuIik7CiAgICB9CiAgICBpZiAoIWVwaURhdGEgfHwgIWVwaURhdGEuZW50cnkgfHwgZXBpRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImVQSSBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQoKICAgIC8vIDEuIENoZWNrIENvbXBvc2l0aW9uLmxhbmd1YWdlCiAgICBlcGlEYXRhLmVudHJ5Py5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIkNvbXBvc2l0aW9uIiAmJiByZXMubGFuZ3VhZ2UpIHsKICAgICAgICAgICAgbGFuZyA9IHJlcy5sYW5ndWFnZTsKICAgICAgICAgICAgY29uc29sZS5sb2coIkRldGVjdGVkIGZyb20gQ29tcG9zaXRpb24ubGFuZ3VhZ2U6IiwgbGFuZyk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gMi4gSWYgbm90IGZvdW5kLCBjaGVjayBCdW5kbGUubGFuZ3VhZ2UKICAgIGlmICghbGFuZyAmJiBlcGlEYXRhLmxhbmd1YWdlKSB7CiAgICAgICAgbGFuZyA9IGVwaURhdGEubGFuZ3VhZ2U7CiAgICAgICAgY29uc29sZS5sb2coIkRldGVjdGVkIGZyb20gQnVuZGxlLmxhbmd1YWdlOiIsIGxhbmcpOwogICAgfQoKICAgIC8vIDMuIEZhbGxiYWNrCiAgICBpZiAoIWxhbmcpIHsKICAgICAgICBjb25zb2xlLndhcm4oIk5vIGxhbmd1YWdlIGRldGVjdGVkIGluIENvbXBvc2l0aW9uIG9yIEJ1bmRsZS4iKTsKICAgICAgICBsYW5nID0gImVuIjsKICAgIH0KCiAgICAvL1RPRE8gY2hhbmdlIHRoaXMgb3IgdGhlIG9uZSBpbiBxdC1wcm9sb25nYXRpb24gKHNpZC9kb2MgdnMgY29kZXMpCiAgICBsZXQgYXJyYXlPZkNsYXNzZXMgPSBbeyAiY29kZSI6ICJncmF2LTQiLCAic3lzdGVtIjogImh0dHBzOi8vd3d3LmdyYXZpdGF0ZWhlYWx0aC5ldS9zaWQvZG9jIiB9XSAgICAgIC8vd2hhdCB0byBsb29rIGluIGV4dGVuc2lvbnMgLW1hZGUgdXAgY29kZSBiZWNhdXNlIHRoZXJlIGlzIG5vbmUKCiAgICBjb25zdCBjb250YWN0cyA9IFtdOyAvLyBUaGlzIHdpbGwgc3RvcmUgdGhlIGNvbGxlY3RlZCBjb250YWN0IGluZm8KCiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGlwc0RhdGEuZW50cnkpIHsKICAgICAgICBjb25zdCByZXMgPSBlbnRyeS5yZXNvdXJjZTsKICAgICAgICBpZiAoIXJlcyB8fCByZXMucmVzb3VyY2VUeXBlICE9PSAiUGF0aWVudCIpIGNvbnRpbnVlOwoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMuZ2VuZXJhbFByYWN0aXRpb25lcikpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBncFJlZiBvZiByZXMuZ2VuZXJhbFByYWN0aXRpb25lcikgewogICAgICAgICAgICAgICAgY29uc3QgZ3BJZCA9IGdwUmVmLnJlZmVyZW5jZT8uc3BsaXQoIi8iKVsxXTsKICAgICAgICAgICAgICAgIGlmICghZ3BJZCkgY29udGludWU7CgogICAgICAgICAgICAgICAgY29uc3QgZ3BSZXNvdXJjZSA9IGlwc0RhdGEuZW50cnkuZmluZChlID0+IGUucmVzb3VyY2U/LmlkID09PSBncElkKT8ucmVzb3VyY2U7CiAgICAgICAgICAgICAgICBpZiAoIWdwUmVzb3VyY2UpIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBncFJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIlByYWN0aXRpb25lciIgfHwKICAgICAgICAgICAgICAgICAgICBncFJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIk9yZ2FuaXphdGlvbiIKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlbGVjb21zID0gZ3BSZXNvdXJjZS50ZWxlY29tOwogICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRlbGVjb21zKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJlZCA9IHRlbGVjb21zLmZpbHRlcih0ID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbInBob25lIiwgImVtYWlsIl0uaW5jbHVkZXModC5zeXN0ZW0pCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGVsZWNvbSBvZiBmaWx0ZXJlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGVsZWNvbS5zeXN0ZW0sICAgICAgICAgICAgIC8vICdwaG9uZScgb3IgJ2VtYWlsJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0ZWxlY29tLnZhbHVlLCAgICAgICAgICAgICAvLyBlLmcuICcrMTIzNDU2Nzg5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZTogZ3BSZXNvdXJjZS5yZXNvdXJjZVR5cGUsIC8vICdQcmFjdGl0aW9uZXInIG9yICdPcmdhbml6YXRpb24nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGdwUmVzb3VyY2UuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIEV4YW1wbGUgdXNhZ2U6CiAgICBjb25zb2xlLmxvZygiQ29sbGVjdGVkIGNvbnRhY3RzOiIsIGNvbnRhY3RzKTsKCgogICAgLy8gZVBJIHRyYXNsYXRpb24gZnJvbSB0ZXJtaW5vbG9neSBjb2RlcyB0byB0aGVpciBodW1hbiByZWRhYmxlIHRyYW5zbGF0aW9ucyBpbiB0aGUgc2VjdGlvbnMKICAgIGxldCBjb21wb3NpdGlvbnMgPSAwOwogICAgbGV0IGNhdGVnb3JpZXMgPSBbXTsKCiAgICBlcGkuZW50cnkuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgICAgICBpZiAoZW50cnkucmVzb3VyY2UucmVzb3VyY2VUeXBlID09ICJDb21wb3NpdGlvbiIpIHsKICAgICAgICAgICAgY29tcG9zaXRpb25zKys7CiAgICAgICAgICAgIC8vSXRlcmF0ZWQgdGhyb3VnaCB0aGUgQ29uZGl0aW9uIGVsZW1lbnQgc2VhcmNoaW5nIGZvciBjb25kaXRpb25zCiAgICAgICAgICAgIGVudHJ5LnJlc291cmNlLmV4dGVuc2lvbi5mb3JFYWNoKChlbGVtZW50KSA9PiB7CgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBvc2l0aW9uIG9mIHRoZSBleHRlbnNpb25bMV0gaXMgY29ycmVjdAogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnVybCA9PSAiY29uY2VwdCIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTZWFyY2ggdGhyb3VnaCB0aGUgZGlmZmVyZW50IHRlcm1pbm9sb2dpZXMgdGhhdCBtYXkgYmUgYXZhaWJsZSB0byBjaGVjayBpbiB0aGUgY29uZGl0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRlbnNpb25bMV0udmFsdWVDb2RlYWJsZVJlZmVyZW5jZS5jb25jZXB0LmNvZGluZy5mb3JFYWNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvZGluZykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFeHRlbnNpb246ICIgKyBlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyArICI6IiArIGNvZGluZy5jb2RlICsgIiAtICIgKyBjb2Rpbmcuc3lzdGVtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjb2RlIGlzIGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFycmF5T2ZDbGFzc2VzLnNvbWUoaXRlbSA9PiBpdGVtLmNvZGUgPT09IGNvZGluZy5jb2RlICYmIGl0ZW0uc3lzdGVtID09PSBjb2Rpbmcuc3lzdGVtKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2F0ZWdvcnkgaXMgYWxyZWFkeSBpbiB0aGUgbGlzdCBvZiBjYXRlZ29yaWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJGb3VuZCIsIGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWVzLnB1c2goZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKCiAgICBpZiAoY29tcG9zaXRpb25zID09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBlUEk6IG5vIGNhdGVnb3J5ICJDb21wb3NpdGlvbiIgZm91bmQnKTsKICAgIH0KCiAgICBlbHNlIHsKCgogICAgICAgIGxldCByZXNwb25zZSA9IGh0bWxEYXRhOwogICAgICAgIGxldCBkb2N1bWVudDsKCiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGxldCBqc2RvbSA9IGF3YWl0IGltcG9ydCgianNkb20iKTsKICAgICAgICAgICAgbGV0IHsgSlNET00gfSA9IGpzZG9tOwogICAgICAgICAgICBsZXQgZG9tID0gbmV3IEpTRE9NKGh0bWxEYXRhKTsKICAgICAgICAgICAgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50OwogICAgICAgICAgICByZXR1cm4gaW5zZXJ0Q29udGFjdExpbmtzKGNhdGVnb3JpZXMsIGNvbnRhY3RzLCBkb2N1bWVudCwgcmVzcG9uc2UpOwogICAgICAgICAgICAvL2xpc3RPZkNhdGVnb3JpZXMsIGVuaGFuY2VUYWcsIGRvY3VtZW50LCByZXNwb25zZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvY3VtZW50ID0gd2luZG93LmRvY3VtZW50OwogICAgICAgICAgICByZXR1cm4gaW5zZXJ0Q29udGFjdExpbmtzKGNhdGVnb3JpZXMsIGNvbnRhY3RzLCBkb2N1bWVudCwgcmVzcG9uc2UpOwogICAgICAgIH0KICAgIH07Cn07CgoKZnVuY3Rpb24gZ2V0UmVwb3J0KGxhbmcgPSAiZW4iKSB7CiAgICBjb25zb2xlLmxvZygiR2VuZXJhdGluZyByZXBvcnQgaW4gbGFuZ3VhZ2U6IiwgbGFuZyk7CiAgICByZXR1cm4geyBtZXNzYWdlOiBnZXRFeHBsYW5hdGlvbihsYW5nKSwgc3RhdHVzOiAiIiB9OwoKCn0KCi8vIC0tLSBHZXQgdXNlci1mYWNpbmcgcmVwb3J0IHNlbnRlbmNlIGluIHRoZSBzZWxlY3RlZCBsYW5ndWFnZSAtLS0KZnVuY3Rpb24gZ2V0RXhwbGFuYXRpb24obGFuZyA9ICJlbiIpIHsKICAgIGNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIGV4cGxhbmF0aW9uIGluIGxhbmd1YWdlOiIsIGxhbmcpOwogICAgcmV0dXJuICIiOwp9CgovLyAtLS0gRXhwb3J0ZWQgQVBJIC0tLQpyZXR1cm4gewogICAgZW5oYW5jZTogZW5oYW5jZSwKICAgIGdldFNwZWNpZmljYXRpb246IGdldFNwZWNpZmljYXRpb24sCiAgICBleHBsYW5hdGlvbjogKGxhbmd1YWdlKSA9PiBnZXRFeHBsYW5hdGlvbihsYW5ndWFnZSB8fCBsYW5nIHx8ICJlbiIpLAogICAgcmVwb3J0OiAobGFuZ3VhZ2UpID0+IGdldFJlcG9ydChsYW5ndWFnZSB8fCBsYW5nIHx8ICJlbiIpLAp9Owo=",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para información de contacto"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para informação de contacto"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til kontaktinformation"
              }
            ]
          }
        ]
      }
    }
  ]
}